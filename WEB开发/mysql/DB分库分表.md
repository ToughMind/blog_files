---
title: "DB分库分表"
date: 2020-01-17T11:51:28+08:00
description: ""
lastmod: 2018-07-10T00:00:00+08:00
draft: false
tags: ["mysql"]
categories: ["mysql"]

weight: 1
contentCopyright: MIT
mathjax: true
autoCollapseToc: true
---
### 1、基本思想

- Sharding的基本思想是把一个数据库切分成多个部分放到不同的数据库上，缓解单一数据库的性能问题。

- 对于海量数据，如果因为表多而数据多，适合垂直切分，把关系紧密的表切分出来；若是某张表的数据过大，适合水平切分，按某种规则如id散列切分到多个数据库。

### 2、切分策略

- 先垂直，再水平

- 事务问题
  - 分布式事务
    - 优点：由数据库管理，简单有效。
    - 缺点：性能代价高，特别是shard越来越多时。
  - 程序和数据库共同控制
    - 原理：将一个跨多个数据的分布式事务拆分成多个仅处于单个数据库上的小事务，通过程序来控制各个小事务。
    
- 跨节点Join问题
  - 普遍做法分两次查询实现。第一次查询结果集中找出关联数据的id，根据这些id发起第二次请求
  
- 跨节点的count，order by，group by以及聚合函数的问题
  - 类似Join的处理，分别在各个节点上得到结果再在应用程序端合并。不同点在于可以并发执行，但要考虑到内存消耗
  
### 3、关于垂直切分Vertical Sharding的粒度

- 若规划到一起的表关系紧密，且数据量不大，增长缓慢，适宜放在一个shard里，不需要再进行水平切分

- 反之，则势必要水平切分，就意味着单一shard会被细分成多个更小的shard，每一个shard存在一个主表和多个相关的关联表

