---
title: "网络工程相关"
date: 2020-01-17T11:51:28+08:00
description: ""
lastmod: 2018-07-10T00:00:00+08:00
draft: false
tags: ["网络"]
categories: ["网络"]

weight: 1
contentCopyright: MIT
mathjax: true
autoCollapseToc: true
---
### 1、OSI的七层协议
- 应用层
- 表示层
- 会话层
- 运输层
- 网络层
- 数据链路层
- 物理层

### 2、TCP/IP的体系结构
- 应用层（各种应用层协议如TELNET,FTP,SMTP等）
- 运输层（TCP或UDP）
- 网际层（IP）
- 网络接口层

### 3、五层协议的体系结构
- 应用层
- 运输层
- 网络层
- 数据链路层
- 物理层 

### 4、简单概念
- 应用层：协议很多，有支持万维网应用的http协议，支持电邮的smtp协议，支持文件传输的ftp协议等等。
- 运输层
  - TCP：传输控制协议，面向连接的，数据传输的单位是报文段，能够提供可靠地交付。
  - UDP：用户数据报协议，无连接的，数据传输的单位是用户数据报，不保证提供可靠地交付。
- 网络层
  - 负责为分组交换网上的不同主机提供通信服务
  - 在发送数据时，网络层把运输层产生的报文段或用户数据报封装成分组或包进行传送
  - 选择合适的路由，使源主机运输层所传下来的分组，能够通过网络中的路由器找到目的主机
- 数据链路层
  - 链路层将网络层交下来的IP数据报组装成帧，在两个相邻结点之间的链路上透明地传送帧中的数据。
- 物理层：在物理层上所传数据的单位是比特。物理层的任务就是透明地传送比特流。


### 5、HTTP协议
- HTTP协议主要应用是在服务器和客户端之间，客户端接受超文本。
- HTTP是一个无状态的协议。也就是说，不能通过一个状态判断连接的状态，因此有时候，计算机之间通信需要通过其他协议来协同工作，一起提供支持。
- 工作特点
  - 基于B/S 模式，同时可以提供登陆认证和网间安全传输，例如HTTP下加入SSL层，可以提供安全的HTTPS服务。
  - 通信开销小，简单快速，传输成本低
  - 节省传输时间
  - 使用灵活：超文本协议，允许服务器和客户端传输任意类型或者任意数据结构的数据对象。
  - 可能影响传输效率，无状态。
  
- 工作原理：用户通过客户端向服务端发起一个请求，创建一个TCP连接，指定端口号，默认是80，然后连接到服务器工作。在那个端口监听浏览器请求。一旦监听到客户端请求，分析请求类型后，服务器会向客户端返回一个响应状态，比如"HTTP/1.0 404 OK"，同时会返回特定的数据内容，如请求的资源，错误代码，其它状态信息等等。
  - HTTP协议请求报文：请求方法URI协议/版本、请求头、请求正文
  - HTTP协议的响应报文：协议状态版本代码描述、响应头、响应正文
  
### HTTP状态码
- 1xx消息
- 2xx成功
  - 200 OK
  - 201 Created
  - 202 Accepted：服务器已接受请求，但尚未处理。
- 3xx重定向
  - 301 Moved Permanently：被请求的资源已永久移动到新位置，并且将来任何对此资源的引用都应该使用本响应返回的若干个URI之一。
  - 302 Found：要求客户端执行临时重定向。
  - 303 See Other
- 4xx客户端错误
  - 400 Bad Request
  - 403 Forbidden
  - 404 Not Found
- 5xx服务器错误

### 6、HTTPS协议工作原理
Https是一种基于SSL/TLS的Http协议，所有的http数据都是在SSL/TLS协议封装之上传输的。
- HTTP协议运行在TCP之上，所有传输的内容都是明文，客户端和服务器端都无法验证对方的身份。
- HTTPS是运行在SSL/TLS之上的HTTP协议，SSL/TLS运行在TCP之上。所有传输的内容都经过加密，加密采用对称加密，但对称加密的密钥用服务器方的证书进行了非对称加密。
- TLS/SSL中使用了非对称加密，对称加密以及HASH算法。

### 7、对称加密和非对称加密
- 对称加密是指加密和解密使用的密钥是同一个密钥，或者可以相互推算
- 非对称加密和解密使用的密钥不是同一密钥，其中一个对外界公开，被称为公钥，另一个只有所有者知道，称作私钥。

### 8、握手过程的简单描述
- 1.浏览器将自己支持的一套加密规则发送给网站。
- 2.网站从中选出一组加密算法与HASH算法，并将自己的身份信息以证书的形式发回给浏览器。证书里面包含了网站地址，加密公钥，以及证书的颁发机构等信息。
- 3.获得网站证书之后浏览器要做以下工作：
  - a) 验证证书的合法性（颁发证书的机构是否合法，证书中包含的网站地址是否与正在访问的地址一致等），如果证书受信任，则浏览器栏里面会显示一个小锁头，否则会给出证书不受信的提示。
  - b) 如果证书受信任，或者是用户接受了不受信的证书，浏览器会生成一串随机数的密码，并用证书中提供的公钥加密。
  - c) 使用约定好的HASH计算握手消息，并使用生成的随机数对消息进行加密，最后将之前生成的所有信息发送给网站。
- 4.网站接收浏览器发来的数据之后要做以下的操作：
  - a) 使用自己的私钥将信息解密取出密码，使用密码解密浏览器发来的握手消息，并验证HASH是否与浏览器发来的一致
  - b) 使用密码加密一段握手消息，发送给浏览器。
- 此时握手过程结束，之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密。

### 9、HTTPS一般使用的加密与HASH算法如下：
- 其中非对称加密算法用于在握手过程中加密生成的密码，对称加密算法用于对真正传输的数据进行加密，而HASH算法用于验证数据的完整性。

非对称加密算法：RSA，DSA/DSS

对称加密算法：AES，RC4，3DES

HASH算法：MD5，SHA1，SHA256

### 10、常见的网络攻击
- CSRF(Cross-site Request Forgery)，中文名称：跨站伪造。
  - 访问csrf的措施虽然很多，但归根到底就是一条：在客户端提交请求时增加伪造随机数。

- XSS 全称(Cross Site Scripting) 跨站脚本攻击
  - Dom-Based XSS 漏洞，威胁用户个体
  - Stored XSS(存储式XSS漏洞),脚本上传到服务器，威胁的对象将是大量的用户
  
- 请求劫持
  - DNS劫持：修改域名的解析结果，原IP地址转入到修改后的指定IP
  - http劫持：例如fiddler
 
- 尽量使用https

- 其他安全措施，针对http
  - X-XSS-Protection：这个header主要是用来防止浏览器中的反射性xss。
  - X-Content-Type-Options：这个header主要用来防止在IE9、chrome和safari中的MIME类型混淆攻击
  - Strict-Transport-Security（STS）是用来配置浏览器和服务器之间安全的通信
 
### 11.1、TCP 三次握手
- 目的是同步连接双方的序列号和确认号，
- 第一次：客户端A发送SYN包（SYN=j）到服务器B
- 第二次：服务器B收到SYN包，必须确认客户A的SYN（ACK=j+1），同时自己也发送一个SYN包（SYN=k），即SYN+ACK包
- 客户端A收到服务器B的SYN＋ACK包，向服务器B发送确认包ACK（ACK=k+1）
[图](http://images.cnitblog.com/blog/342885/201310/05103122-34bb1724aec840c5a27c645399df19ba.jpg)
 
### 11.2、TCP 四次挥手
- 由于TCP连接是全双工的，因此每个方向都必须单独进行关闭
- 首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。
- 第一次：A发送一个FIN
- 第二次：B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1
- 第三次：B关闭与A的连接，发送一个FIN给A
- 第四次：A发回ACK报文确认，并将确认序号设置为收到序号加1

[图](http://images.cnitblog.com/blog/342885/201310/05103133-28bf2a8ba09e4d959c7deb504beaedb6.jpg)

### 11.3、为什么连接3次，关闭4次
- 服务端可以把ACK和SYN（ACK起应答作用，而SYN起同步作用）放在一个报文里来发送
- 对于关闭
  - 当你收到了FIN，代表它没有数据给你了，但未必你所有数据都发送给它了；所以你未必马上关闭socket，可能数据发送完了，再发送FIN
  - 所以ACK和FIN报文多数是分开发送的 